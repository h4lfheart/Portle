<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
        xmlns:ext="clr-namespace:Portle.Extensions;assembly=Portle"
        xmlns:windowModels="clr-namespace:Portle.WindowModels"
        xmlns:sidebar="clr-namespace:Portle.Controls.Navigation.Sidebar"
        xmlns:controls="clr-namespace:Portle.Controls"
        xmlns:material="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:views="clr-namespace:Portle.Views"
        xmlns:information="clr-namespace:Portle.Models.Information"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="Portle.Windows.AppWindow"
        x:DataType="windowModels:AppWindowModel"
        Width="1000" Height="600" RequestedThemeVariant="Dark" Background="#0e0e0e" TransparencyLevelHint="Mica"
        ExtendClientAreaToDecorationsHint="True" ExtendClientAreaChromeHints="NoChrome"
        FontFamily="{StaticResource SFTextRegular}"
        WindowStartupLocation="CenterScreen" ClosingBehavior="OwnerAndChildWindows"
        ExtendClientAreaTitleBarHeightHint="35"
        Icon="/Assets/PortleLogo.ico"
        Title="Portle">
     <Grid RowDefinitions="35, *" Margin="{Binding $parent[Window].OffScreenMargin}">
        <Grid Grid.Row="0" Grid.RowSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="175" />
                <ColumnDefinition Width="6*" />
            </Grid.ColumnDefinitions>
            <!-- Sidebar -->
            <Grid Grid.Column="0">
                <sidebar:Sidebar x:Name="Sidebar" ItemSelected="OnSidebarItemSelected">
                    <sidebar:Sidebar.Header>
                        <Grid Grid.Row="0" IsHitTestVisible="False" RowDefinitions="*,*">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="{ext:Space 2}" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Image Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Source="/Assets/PortleLogo.png"
                                   Width="48" Height="48" RenderOptions.BitmapInterpolationMode="HighQuality" />

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Portle"
                                       FontSize="16" FontFamily="{StaticResource SFTextBold}"
                                       Classes="TextFillColorPrimaryBrush"
                                       VerticalAlignment="Center"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding VersionString}"
                                       FontSize="13" FontFamily="{StaticResource SFTextRegular}"
                                       Classes="TextFillColorSecondaryBrush"
                                       VerticalAlignment="Center" />
                        </Grid>
                    </sidebar:Sidebar.Header>
                    <sidebar:Sidebar.Items>
                        
                        <sidebar:SidebarItemText Text="SETUP" IsVisible="{Binding !AppSettings.Application.FinishedSetup}"/>
                        <sidebar:SidebarItemButton Text="Setup" Icon="CheckboxesMarked" Tag="{x:Type views:SetupView}" 
                                                   IsVisible="{Binding !AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemSeparator IsVisible="{Binding !AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemText Text="MANAGEMENT" IsVisible="{Binding AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemButton Text="Profiles" Icon="Folder" Tag="{x:Type views:ProfilesView}" 
                                                   IsVisible="{Binding AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemButton Text="Downloads" Icon="Download" Tag="{x:Type views:DownloadsView}" 
                                                   IsVisible="{Binding AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemButton Text="Repositories" Icon="Server" Tag="{x:Type views:RepositoriesView}" 
                                                   IsVisible="{Binding AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemSeparator IsVisible="{Binding AppSettings.Application.FinishedSetup}"/>
                        
                        <sidebar:SidebarItemText Text="SETTINGS"/>
                        
                        <sidebar:SidebarItemButton Text="App Settings" Icon="Settings" Tag="{x:Type views:SettingsView}"/>

                    </sidebar:Sidebar.Items>
                </sidebar:Sidebar>
            </Grid>

            <GridSplitter Grid.Column="0" HorizontalAlignment="Right" Opacity="0" />

            <Border x:Name="ContentBorder" Grid.Column="1" Background="#0a0a0a"
                    BorderThickness="2 2 0 0" CornerRadius="16 0 0 0"
                    BorderBrush="#212121" Margin="0 35 0 0" ClipToBounds="True">
                <ui:Frame x:Name="ContentFrame" IsNavigationStackEnabled="False" />
            </Border>
        </Grid>

        <ItemsControl Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Right" Width="500"
                      Margin="{ext:Space 1}" ItemsSource="{Binding Info.Messages}" ClipToBounds="False">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <controls:ContentCard ClipToBounds="False" Classes="FadeIn">
                        <controls:ContentCard.BoxShadow>
                            inset 0 1 2 -1 #50ffffff,
                            inset 0 -1 2 -2 #50ffffff,
                            0 4 8 #20000000,
                            0 8 12 #10000000,
                            0 0 16 4 #80000000
                        </controls:ContentCard.BoxShadow>
                        <controls:ContentCard.Styles>
                            <Style Selector="controls|ContentCard.FadeIn">
                                <Style.Animations>
                                    <Animation Duration="0:0:0.1">
                                        <KeyFrame Cue="0%">
                                            <Setter Property="Opacity" Value="0.0" />
                                        </KeyFrame>
                                        <KeyFrame Cue="100%">
                                            <Setter Property="Opacity" Value="1.0" />
                                        </KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </controls:ContentCard.Styles>
                        <Grid Margin="{ext:Space 1.5}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="{ext:Space 1}" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Center"
                                  ColumnDefinitions="Auto 8 *" Margin="{ext:Space 0, 0, 0, 0.5}">
                                <material:MaterialIcon Grid.Column="0" Kind="{Binding SeverityIcon}"
                                                       VerticalAlignment="Center" />

                                <TextBlock Grid.Column="2" HorizontalAlignment="Left" VerticalAlignment="Center"
                                           Text="{Binding Title}" Classes="BodyStrongTextBlockStyle" />
                            </Grid>


                            <TextBlock Grid.Row="1" Grid.Column="0" HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       TextWrapping="Wrap"
                                       Text="{Binding Message}"
                                       Classes="BodyTextBlockStyle TextFillColorSecondaryBrush" />

                            <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="2" HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="{ext:Space -0.5}"
                                    Content="{material:MaterialIconExt Close}" Command="{Binding CloseCommand}" />

                            <Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Margin="{ext:Space 0, 1, 0, 0}"
                                    HorizontalAlignment="Stretch"
                                    IsVisible="{Binding UseButton}"
                                    Content="{Binding ButtonTitle}"
                                    Command="{Binding ButtonCommand}" />
                        </Grid>
                    </controls:ContentCard>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Vertical" Spacing="{ext:Space 1}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>

        <Grid Grid.Row="0" Grid.RowSpan="2"  ColumnDefinitions="* 2* *" 
              DataContext="{Binding Info.DialogQueue.Current}"
              IsVisible="{Binding IsOpen, FallbackValue=False}">
            
            <Border Grid.Column="0" Grid.ColumnSpan="3"
                    Background="#80000000" IsHitTestVisible="False"/>
            
            <controls:ContentCard Grid.Column="1" ClipToBounds="False" IsEnabled="{Binding IsOpen, FallbackValue=False}"
                                  VerticalAlignment="Center">
                <controls:ContentCard.BoxShadow>
                    inset 0 1 2 -1 #50ffffff,
                    inset 0 -1 2 -2 #50ffffff,
                    0 4 8 #20000000,
                    0 8 12 #10000000,
                    0 0 16 4 #80000000
                </controls:ContentCard.BoxShadow>
                <Grid Margin="{ext:Space 3}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="{ext:Space 1}" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="{ext:Space 1}" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Row="0" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Center" >

                        <TextBlock HorizontalAlignment="Left" VerticalAlignment="Center"
                                   Text="{Binding Title}" Classes="BodyStrongTextBlockStyle" FontSize="18" />
                    </Grid>
                    
                    <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" HorizontalAlignment="Left" VerticalAlignment="Center"
                               TextWrapping="Wrap"
                               Text="{Binding Message}" Classes="BodyTextBlockStyle TextFillColorSecondaryBrush" />
                    
                    <ContentControl Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" ClipToBounds="False"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                    Content="{Binding Content}"/>
                    
                    <ItemsControl Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" 
                                  Margin="{ext:Space 0, 2, 0, 0}"
                                  ItemsSource="{Binding Buttons}"
                                  ClipToBounds="False">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="information:DialogButton">
                                <Button Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" ClipToBounds="False"
                                        HorizontalAlignment="Stretch"
                                        Content="{Binding Text}"
                                        Command="{Binding ExecuteCommand}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Spacing="{ext:Space 1.5}"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>

                    <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="2" HorizontalAlignment="Right"
                            IsVisible="{Binding CanClose}"
                            VerticalAlignment="Top"
                            Margin="{ext:Space -1}"
                            Content="{material:MaterialIconExt Close}" Command="{Binding CloseCommand}" />

                </Grid>
            </controls:ContentCard>
        </Grid>
         
        <Grid Grid.Row="0" HorizontalAlignment="Stretch" PointerPressed="OnPointerPressedUpperBar">
            <Grid HorizontalAlignment="Right">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="{ext:Space 0.5}" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="{ext:Space 0.5}" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" PointerPressed="OnMinimizePressed" Cursor="Hand" CornerRadius="0"
                        Classes="MinimizeMaximize" Child="{material:MaterialIconExt Minus}" Width="35" Height="35" />
                <Border Grid.Column="2" PointerPressed="OnMaximizePressed" Cursor="Hand" CornerRadius="0"
                        Classes="MinimizeMaximize" Child="{material:MaterialIconExt Maximize}" Width="35" Height="35" />
                <Border Grid.Column="4" PointerPressed="OnClosePressed" Cursor="Hand" CornerRadius="0" Classes="Close"
                        Child="{material:MaterialIconExt Close}" Width="35" Height="35" />
            </Grid>
        </Grid>
    </Grid>
</Window>
